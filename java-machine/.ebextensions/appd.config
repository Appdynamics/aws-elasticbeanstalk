files:
    "/tmp/appagent.zip":
      mode: "000444"
      owner: ec2-user
      group: ec2-user
      source: https://packages.appdynamics.com/java/4.4.0.3/AppServerAgent-4.4.0.3.zip
    "/tmp/machineagent.zip":
      mode: "000444"
      owner: ec2-user
      group: ec2-user
      source: https://packages.appdynamics.com/machine/4.4.1.570/MachineAgent-4.4.1.570.zip
    "/tmp/appd.sh":
      mode: "000755"
      owner: ec2-user
      group: ec2-user
      source: https://raw.githubusercontent.com/michaelenglert/aws-elasticbeanstalk/master/java-machine/appd.sh

commands:
    01reset:
      command: "rm -rf /opt/appdynamics"
      ignoreErrors: true
    02makedir-appagent:
      command: "mkdir -p /opt/appdynamics/appagent"
    02makedir-machineagent:
      command: "mkdir -p /opt/appdynamics/machineagent"
    03unzip-appagent:
      command: "unzip /tmp/appagent.zip"
      cwd: /opt/appdynamics/appagent
    03unzip-machineagent:
      command: "unzip /tmp/machineagent.zip"
      cwd: /opt/appdynamics/machineagent
    04perms-appagent:
      command: "sudo chown -R webapp:webapp appagent"
      cwd: /opt/appdynamics
    04perms-machineagent:
      command: "sudo chown -R webapp:webapp machineagent"
      cwd: /opt/appdynamics
    06cleanup:
      command: "rm /tmp/*agent.zip"
      ignoreErrors: true

container_commands:
    01enable-appd:
      command: "/tmp/appd.sh"
    02start-appd-machine:
      command: "./machine-agent"
      cwd: "/opt/appdynamics/machineagent/bin/"

option_settings:
    aws:elasticbeanstalk:application:environment:
      APPDYNAMICS_CONTROLLER_HOST_NAME:
      APPDYNAMICS_CONTROLLER_PORT:
      APPDYNAMICS_CONTROLLER_SSL_ENABLED:
      APPDYNAMICS_AGENT_ACCOUNT_NAME:
      APPDYNAMICS_AGENT_ACCOUNT_ACCESS_KEY:
      APPDYNAMICS_AGENT_APPLICATION_NAME:
      APPDYNAMICS_AGENT_TIER_NAME:
